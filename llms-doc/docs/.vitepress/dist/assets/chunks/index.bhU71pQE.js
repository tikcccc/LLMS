import{x as H,b as Et,d as St,i as ht,T as et,a as nt,t as G}from"../app.Dc_qmlct.js";import{m as ut,a as dt}from"./min.C8X95urT.js";import{s as Mt}from"./array.DEnAxiAM.js";import{w as _t,c as ft}from"./path.CbwjOpE9.js";import{x as Ct,y as Xt}from"./point.DWREGWZc.js";import{o as Tt}from"./ordinal.BYWQX77i.js";import{c as Rt}from"./colors.Cc3OSVma.js";import"./framework.DwA3BYN2.js";import"./theme.Bi4jKG3j.js";import"./init.Gi6I4Gst.js";function $t(t,e){let n,i=-1,a=-1;if(e===void 0)for(const s of t)++a,s!=null&&(n>s||n===void 0&&s>=s)&&(n=s,i=a);else for(let s of t)(s=e(s,++a,t))!=null&&(n>s||n===void 0&&s>=s)&&(n=s,i=a);return i}function At(t){let e;for(;e=t.sourceEvent;)t=e;return t}function F(t,e){if(t=At(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}const st={capture:!0,passive:!1};function lt(t){t.preventDefault(),t.stopImmediatePropagation()}function Dt(t){var e=t.document.documentElement,n=H(t).on("dragstart.drag",lt,st);"onselectstart"in e?n.on("selectstart.drag",lt,st):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function jt(t,e){var n=t.document.documentElement,i=H(t).on("dragstart.drag",null);e&&(i.on("click.drag",lt,st),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var Bt=1e-12;function mt(t){return((t=Math.exp(t))+1/t)/2}function Ot(t){return((t=Math.exp(t))-1/t)/2}function It(t){return((t=Math.exp(2*t))-1)/(t+1)}const Pt=function t(e,n,i){function a(s,h){var l=s[0],c=s[1],d=s[2],f=h[0],v=h[1],x=h[2],E=f-l,_=v-c,M=E*E+_*_,C,y;if(M<Bt)y=Math.log(x/d)/e,C=function(B){return[l+B*E,c+B*_,d*Math.exp(e*B*y)]};else{var T=Math.sqrt(M),D=(x*x-d*d+i*M)/(2*d*n*T),j=(x*x-d*d-i*M)/(2*x*n*T),$=Math.log(Math.sqrt(D*D+1)-D),R=Math.log(Math.sqrt(j*j+1)-j);y=(R-$)/e,C=function(B){var V=B*y,Y=mt($),W=d/(n*T)*(Y*It(e*V+$)-Ot($));return[l+W*E,c+W*_,d*Y/mt(e*V+$)]}}return C.duration=y*1e3*e/Math.SQRT2,C}return a.rho=function(s){var h=Math.max(.001,+s),l=h*h,c=l*l;return t(h,l,c)},a}(Math.SQRT2,2,4),Ht=Rt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function Vt(t){return t.source}function Yt(t){return t.target}function Wt(t){let e=Vt,n=Yt,i=Ct,a=Xt,s=null,h=null,l=_t(c);function c(){let d;const f=Mt.call(arguments),v=e.apply(this,f),x=n.apply(this,f);if(s==null&&(h=t(d=l())),h.lineStart(),f[0]=v,h.point(+i.apply(this,f),+a.apply(this,f)),f[0]=x,h.point(+i.apply(this,f),+a.apply(this,f)),h.lineEnd(),d)return h=null,d+""||null}return c.source=function(d){return arguments.length?(e=d,c):e},c.target=function(d){return arguments.length?(n=d,c):n},c.x=function(d){return arguments.length?(i=typeof d=="function"?d:ft(+d),c):i},c.y=function(d){return arguments.length?(a=typeof d=="function"?d:ft(+d),c):a},c.context=function(d){return arguments.length?(d==null?s=h=null:h=t(s=d),c):s},c}function Ft(){return Wt(Et)}const U=t=>()=>t;function qt(t,{sourceEvent:e,target:n,transform:i,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:a}})}function it(t){t.stopImmediatePropagation()}function K(t){t.preventDefault(),t.stopImmediatePropagation()}function Gt(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Kt(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function pt(){return this.__zoom||ht}function Lt(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Nt(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ut(t,e,n){var i=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],h=t.invertY(e[1][1])-n[1][1];return t.translate(a>i?(i+a)/2:Math.min(0,i)||Math.max(0,a),h>s?(s+h)/2:Math.min(0,s)||Math.max(0,h))}function Zt(){var t=Gt,e=Kt,n=Ut,i=Lt,a=Nt,s=[0,1/0],h=[[-1/0,-1/0],[1/0,1/0]],l=250,c=Pt,d=St("start","zoom","end"),f,v,x,E=500,_=150,M=0,C=10;function y(o){o.property("__zoom",pt).on("wheel.zoom",V,{passive:!1}).on("mousedown.zoom",Y).on("dblclick.zoom",W).filter(a).on("touchstart.zoom",L).on("touchmove.zoom",N).on("touchend.zoom touchcancel.zoom",q).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(o,m,u,g){var k=o.selection?o.selection():o;k.property("__zoom",pt),o!==k?$(o,m,u,g):k.interrupt().each(function(){R(this,arguments).event(g).start().zoom(null,typeof m=="function"?m.apply(this,arguments):m).end()})},y.scaleBy=function(o,m,u,g){y.scaleTo(o,function(){var k=this.__zoom.k,w=typeof m=="function"?m.apply(this,arguments):m;return k*w},u,g)},y.scaleTo=function(o,m,u,g){y.transform(o,function(){var k=e.apply(this,arguments),w=this.__zoom,z=u==null?j(k):typeof u=="function"?u.apply(this,arguments):u,S=w.invert(z),r=typeof m=="function"?m.apply(this,arguments):m;return n(D(T(w,r),z,S),k,h)},u,g)},y.translateBy=function(o,m,u,g){y.transform(o,function(){return n(this.__zoom.translate(typeof m=="function"?m.apply(this,arguments):m,typeof u=="function"?u.apply(this,arguments):u),e.apply(this,arguments),h)},null,g)},y.translateTo=function(o,m,u,g,k){y.transform(o,function(){var w=e.apply(this,arguments),z=this.__zoom,S=g==null?j(w):typeof g=="function"?g.apply(this,arguments):g;return n(ht.translate(S[0],S[1]).scale(z.k).translate(typeof m=="function"?-m.apply(this,arguments):-m,typeof u=="function"?-u.apply(this,arguments):-u),w,h)},g,k)};function T(o,m){return m=Math.max(s[0],Math.min(s[1],m)),m===o.k?o:new et(m,o.x,o.y)}function D(o,m,u){var g=m[0]-u[0]*o.k,k=m[1]-u[1]*o.k;return g===o.x&&k===o.y?o:new et(o.k,g,k)}function j(o){return[(+o[0][0]+ +o[1][0])/2,(+o[0][1]+ +o[1][1])/2]}function $(o,m,u,g){o.on("start.zoom",function(){R(this,arguments).event(g).start()}).on("interrupt.zoom end.zoom",function(){R(this,arguments).event(g).end()}).tween("zoom",function(){var k=this,w=arguments,z=R(k,w).event(g),S=e.apply(k,w),r=u==null?j(S):typeof u=="function"?u.apply(k,w):u,p=Math.max(S[1][0]-S[0][0],S[1][1]-S[0][1]),b=k.__zoom,X=typeof m=="function"?m.apply(k,w):m,O=c(b.invert(r).concat(p/b.k),X.invert(r).concat(p/X.k));return function(I){if(I===1)I=X;else{var P=O(I),tt=p/P[2];I=new et(tt,r[0]-P[0]*tt,r[1]-P[1]*tt)}z.zoom(null,I)}})}function R(o,m,u){return!u&&o.__zooming||new B(o,m)}function B(o,m){this.that=o,this.args=m,this.active=0,this.sourceEvent=null,this.extent=e.apply(o,m),this.taps=0}B.prototype={event:function(o){return o&&(this.sourceEvent=o),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(o,m){return this.mouse&&o!=="mouse"&&(this.mouse[1]=m.invert(this.mouse[0])),this.touch0&&o!=="touch"&&(this.touch0[1]=m.invert(this.touch0[0])),this.touch1&&o!=="touch"&&(this.touch1[1]=m.invert(this.touch1[0])),this.that.__zoom=m,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(o){var m=H(this.that).datum();d.call(o,this.that,new qt(o,{sourceEvent:this.sourceEvent,target:y,transform:this.that.__zoom,dispatch:d}),m)}};function V(o,...m){if(!t.apply(this,arguments))return;var u=R(this,m).event(o),g=this.__zoom,k=Math.max(s[0],Math.min(s[1],g.k*Math.pow(2,i.apply(this,arguments)))),w=F(o);if(u.wheel)(u.mouse[0][0]!==w[0]||u.mouse[0][1]!==w[1])&&(u.mouse[1]=g.invert(u.mouse[0]=w)),clearTimeout(u.wheel);else{if(g.k===k)return;u.mouse=[w,g.invert(w)],nt(this),u.start()}K(o),u.wheel=setTimeout(z,_),u.zoom("mouse",n(D(T(g,k),u.mouse[0],u.mouse[1]),u.extent,h));function z(){u.wheel=null,u.end()}}function Y(o,...m){if(x||!t.apply(this,arguments))return;var u=o.currentTarget,g=R(this,m,!0).event(o),k=H(o.view).on("mousemove.zoom",r,!0).on("mouseup.zoom",p,!0),w=F(o,u),z=o.clientX,S=o.clientY;Dt(o.view),it(o),g.mouse=[w,this.__zoom.invert(w)],nt(this),g.start();function r(b){if(K(b),!g.moved){var X=b.clientX-z,O=b.clientY-S;g.moved=X*X+O*O>M}g.event(b).zoom("mouse",n(D(g.that.__zoom,g.mouse[0]=F(b,u),g.mouse[1]),g.extent,h))}function p(b){k.on("mousemove.zoom mouseup.zoom",null),jt(b.view,g.moved),K(b),g.event(b).end()}}function W(o,...m){if(t.apply(this,arguments)){var u=this.__zoom,g=F(o.changedTouches?o.changedTouches[0]:o,this),k=u.invert(g),w=u.k*(o.shiftKey?.5:2),z=n(D(T(u,w),g,k),e.apply(this,m),h);K(o),l>0?H(this).transition().duration(l).call($,z,g,o):H(this).call(y.transform,z,g,o)}}function L(o,...m){if(t.apply(this,arguments)){var u=o.touches,g=u.length,k=R(this,m,o.changedTouches.length===g).event(o),w,z,S,r;for(it(o),z=0;z<g;++z)S=u[z],r=F(S,this),r=[r,this.__zoom.invert(r),S.identifier],k.touch0?!k.touch1&&k.touch0[2]!==r[2]&&(k.touch1=r,k.taps=0):(k.touch0=r,w=!0,k.taps=1+!!f);f&&(f=clearTimeout(f)),w&&(k.taps<2&&(v=r[0],f=setTimeout(function(){f=null},E)),nt(this),k.start())}}function N(o,...m){if(this.__zooming){var u=R(this,m).event(o),g=o.changedTouches,k=g.length,w,z,S,r;for(K(o),w=0;w<k;++w)z=g[w],S=F(z,this),u.touch0&&u.touch0[2]===z.identifier?u.touch0[0]=S:u.touch1&&u.touch1[2]===z.identifier&&(u.touch1[0]=S);if(z=u.that.__zoom,u.touch1){var p=u.touch0[0],b=u.touch0[1],X=u.touch1[0],O=u.touch1[1],I=(I=X[0]-p[0])*I+(I=X[1]-p[1])*I,P=(P=O[0]-b[0])*P+(P=O[1]-b[1])*P;z=T(z,Math.sqrt(I/P)),S=[(p[0]+X[0])/2,(p[1]+X[1])/2],r=[(b[0]+O[0])/2,(b[1]+O[1])/2]}else if(u.touch0)S=u.touch0[0],r=u.touch0[1];else return;u.zoom("touch",n(D(z,S,r),u.extent,h))}}function q(o,...m){if(this.__zooming){var u=R(this,m).event(o),g=o.changedTouches,k=g.length,w,z;for(it(o),x&&clearTimeout(x),x=setTimeout(function(){x=null},E),w=0;w<k;++w)z=g[w],u.touch0&&u.touch0[2]===z.identifier?delete u.touch0:u.touch1&&u.touch1[2]===z.identifier&&delete u.touch1;if(u.touch1&&!u.touch0&&(u.touch0=u.touch1,delete u.touch1),u.touch0)u.touch0[1]=this.__zoom.invert(u.touch0[0]);else if(u.end(),u.taps===2&&(z=F(z,this),Math.hypot(v[0]-z[0],v[1]-z[1])<C)){var S=H(this).on("dblclick.zoom");S&&S.apply(this,arguments)}}}return y.wheelDelta=function(o){return arguments.length?(i=typeof o=="function"?o:U(+o),y):i},y.filter=function(o){return arguments.length?(t=typeof o=="function"?o:U(!!o),y):t},y.touchable=function(o){return arguments.length?(a=typeof o=="function"?o:U(!!o),y):a},y.extent=function(o){return arguments.length?(e=typeof o=="function"?o:U([[+o[0][0],+o[0][1]],[+o[1][0],+o[1][1]]]),y):e},y.scaleExtent=function(o){return arguments.length?(s[0]=+o[0],s[1]=+o[1],y):[s[0],s[1]]},y.translateExtent=function(o){return arguments.length?(h[0][0]=+o[0][0],h[1][0]=+o[1][0],h[0][1]=+o[0][1],h[1][1]=+o[1][1],y):[[h[0][0],h[0][1]],[h[1][0],h[1][1]]]},y.constrain=function(o){return arguments.length?(n=o,y):n},y.duration=function(o){return arguments.length?(l=+o,y):l},y.interpolate=function(o){return arguments.length?(c=o,y):c},y.on=function(){var o=d.on.apply(d,arguments);return o===d?y:o},y.clickDistance=function(o){return arguments.length?(M=(o=+o)*o,y):Math.sqrt(M)},y.tapDistance=function(o){return arguments.length?(C=+o,y):C},y}class Qt{constructor(){this.listeners=[]}tap(e){return this.listeners.push(e),()=>this.revoke(e)}revoke(e){const n=this.listeners.indexOf(e);n>=0&&this.listeners.splice(n,1)}revokeAll(){this.listeners.splice(0)}call(...e){for(const n of this.listeners)n(...e)}}const Jt=Math.random().toString(36).slice(2,8);let gt=0;function te(){return gt+=1,`mm-${Jt}-${gt}`}function Z(){}function Q(t,e){const n=(i,a)=>e(i,()=>{var s;return(s=i.children)==null?void 0:s.map(h=>n(h,i))},a);return n(t)}function ee(t,...e){const n=(t||"").split(" ").filter(Boolean);return e.forEach(i=>{i&&n.indexOf(i)<0&&n.push(i)}),n.join(" ")}function ne(t,e){const n={timer:0};function i(){n.timer&&(window.clearTimeout(n.timer),n.timer=0)}function a(){i(),n.args&&(n.result=t(...n.args))}return function(...h){return i(),n.args=h,n.timer=window.setTimeout(a,e),n.result}}const vt=typeof navigator<"u"&&navigator.userAgent.includes("Macintosh"),ie=Tt(Ht),re=(t=1,e=3,n=2)=>i=>t+e/n**i.state.depth,ae={autoFit:!1,duration:500,embedGlobalCSS:!0,fitRatio:.95,maxInitialScale:2,scrollForPan:vt,initialExpandLevel:-1,zoom:!0,pan:!0,toggleRecursively:!1,color:t=>{var e;return ie(`${((e=t.state)==null?void 0:e.path)||""}`)},lineWidth:re(),maxWidth:0,nodeMinHeight:16,paddingX:8,spacingHorizontal:80,spacingVertical:5};function oe(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n)|0;return(e>>>0).toString(36)}function A(t){if(typeof t=="string"){const n=t;t=i=>i.matches(n)}const e=t;return function(){let n=Array.from(this.childNodes);return e&&(n=n.filter(i=>e(i))),n}}function se(t){var e=0,n=t.children,i=n&&n.length;if(!i)e=1;else for(;--i>=0;)e+=n[i].value;t.value=e}function le(){return this.eachAfter(se)}function he(t){var e=this,n,i=[e],a,s,h;do for(n=i.reverse(),i=[];e=n.pop();)if(t(e),a=e.children,a)for(s=0,h=a.length;s<h;++s)i.push(a[s]);while(i.length);return this}function ce(t){for(var e=this,n=[e],i,a;e=n.pop();)if(t(e),i=e.children,i)for(a=i.length-1;a>=0;--a)n.push(i[a]);return this}function ue(t){for(var e=this,n=[e],i=[],a,s,h;e=n.pop();)if(i.push(e),a=e.children,a)for(s=0,h=a.length;s<h;++s)n.push(a[s]);for(;e=i.pop();)t(e);return this}function de(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,i=e.children,a=i&&i.length;--a>=0;)n+=i[a].value;e.value=n})}function fe(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function me(t){for(var e=this,n=pe(e,t),i=[e];e!==n;)e=e.parent,i.push(e);for(var a=i.length;t!==n;)i.splice(a,0,t),t=t.parent;return i}function pe(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),a=null;for(t=n.pop(),e=i.pop();t===e;)a=t,t=n.pop(),e=i.pop();return a}function ge(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function ye(){var t=[];return this.each(function(e){t.push(e)}),t}function ve(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function xe(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e}function ct(t,e){var n=new J(t),i=+t.value&&(n.value=t.value),a,s=[n],h,l,c,d;for(e==null&&(e=we);a=s.pop();)if(i&&(a.value=+a.data.value),(l=e(a.data))&&(d=l.length))for(a.children=new Array(d),c=d-1;c>=0;--c)s.push(h=a.children[c]=new J(l[c])),h.parent=a,h.depth=a.depth+1;return n.eachBefore(be)}function ke(){return ct(this).eachBefore(ze)}function we(t){return t.children}function ze(t){t.data=t.data.data}function be(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function J(t){this.data=t,this.depth=this.height=0,this.parent=null}J.prototype=ct.prototype={constructor:J,count:le,each:he,eachAfter:ue,eachBefore:ce,sum:de,sort:fe,path:me,ancestors:ge,descendants:ye,leaves:ve,links:xe,copy:ke};const Ee="2.1.2",Se={version:Ee},{version:Me}=Se,_e=Object.freeze({children:t=>t.children,nodeSize:t=>t.data.size,spacing:0});function kt(t){const e=Object.assign({},_e,t);function n(l){const c=e[l];return typeof c=="function"?c:()=>c}function i(l){const c=h(s(),l,d=>d.children);return c.update(),c.data}function a(){const l=n("nodeSize"),c=n("spacing");return class xt extends ct.prototype.constructor{constructor(f){super(f)}copy(){const f=h(this.constructor,this,v=>v.children);return f.each(v=>v.data=v.data.data),f}get size(){return l(this)}spacing(f){return c(this,f)}get nodes(){return this.descendants()}get xSize(){return this.size[0]}get ySize(){return this.size[1]}get top(){return this.y}get bottom(){return this.y+this.ySize}get left(){return this.x-this.xSize/2}get right(){return this.x+this.xSize/2}get root(){const f=this.ancestors();return f[f.length-1]}get numChildren(){return this.hasChildren?this.children.length:0}get hasChildren(){return!this.noChildren}get noChildren(){return this.children===null}get firstChild(){return this.hasChildren?this.children[0]:null}get lastChild(){return this.hasChildren?this.children[this.numChildren-1]:null}get extents(){return(this.children||[]).reduce((f,v)=>xt.maxExtents(f,v.extents),this.nodeExtents)}get nodeExtents(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}static maxExtents(f,v){return{top:Math.min(f.top,v.top),bottom:Math.max(f.bottom,v.bottom),left:Math.min(f.left,v.left),right:Math.max(f.right,v.right)}}}}function s(){const l=a(),c=n("nodeSize"),d=n("spacing");return class extends l{constructor(f){super(f),Object.assign(this,{x:0,y:0,relX:0,prelim:0,shift:0,change:0,lExt:this,lExtRelX:0,lThr:null,rExt:this,rExtRelX:0,rThr:null})}get size(){return c(this.data)}spacing(f){return d(this.data,f.data)}get x(){return this.data.x}set x(f){this.data.x=f}get y(){return this.data.y}set y(f){this.data.y=f}update(){return wt(this),zt(this),this}}}function h(l,c,d){const f=(v,x)=>{const E=new l(v);Object.assign(E,{parent:x,depth:x===null?0:x.depth+1,height:0,length:1});const _=d(v)||[];return E.children=_.length===0?null:_.map(M=>f(M,E)),E.children&&Object.assign(E,E.children.reduce((M,C)=>({height:Math.max(M.height,C.height+1),length:M.length+C.length}),E)),E};return f(c,null)}return Object.assign(i,{nodeSize(l){return arguments.length?(e.nodeSize=l,i):e.nodeSize},spacing(l){return arguments.length?(e.spacing=l,i):e.spacing},children(l){return arguments.length?(e.children=l,i):e.children},hierarchy(l,c){const d=typeof c>"u"?e.children:c;return h(a(),l,d)},dump(l){const c=n("nodeSize"),d=f=>v=>{const x=f+"  ",E=f+"    ",{x:_,y:M}=v,C=c(v),y=v.children||[],T=y.length===0?" ":`,${x}children: [${E}${y.map(d(E)).join(E)}${x}],${f}`;return`{ size: [${C.join(", ")}],${x}x: ${_}, y: ${M}${T}},`};return d(`
`)(l)}}),i}kt.version=Me;const wt=(t,e=0)=>(t.y=e,(t.children||[]).reduce((n,i)=>{const[a,s]=n;wt(i,t.y+t.ySize);const h=(a===0?i.lExt:i.rExt).bottom;a!==0&&Xe(t,a,s);const l=Oe(h,a,s);return[a+1,l]},[0,null]),Ce(t),Be(t),t),zt=(t,e,n)=>{typeof e>"u"&&(e=-t.relX-t.prelim,n=0);const i=e+t.relX;return t.relX=i+t.prelim-n,t.prelim=0,t.x=n+t.relX,(t.children||[]).forEach(a=>zt(a,i,t.x)),t},Ce=t=>{(t.children||[]).reduce((e,n)=>{const[i,a]=e,s=i+n.shift,h=a+s+n.change;return n.relX+=h,[s,h]},[0,0])},Xe=(t,e,n)=>{const i=t.children[e-1],a=t.children[e];let s=i,h=i.relX,l=a,c=a.relX,d=!0;for(;s&&l;){s.bottom>n.lowY&&(n=n.next);const f=h+s.prelim-(c+l.prelim)+s.xSize/2+l.xSize/2+s.spacing(l);(f>0||f<0&&d)&&(c+=f,Te(a,f),Re(t,e,n.index,f)),d=!1;const v=s.bottom,x=l.bottom;v<=x&&(s=Ae(s),s&&(h+=s.relX)),v>=x&&(l=$e(l),l&&(c+=l.relX))}!s&&l?De(t,e,l,c):s&&!l&&je(t,e,s,h)},Te=(t,e)=>{t.relX+=e,t.lExtRelX+=e,t.rExtRelX+=e},Re=(t,e,n,i)=>{const a=t.children[e],s=e-n;if(s>1){const h=i/s;t.children[n+1].shift+=h,a.shift-=h,a.change-=i-h}},$e=t=>t.hasChildren?t.firstChild:t.lThr,Ae=t=>t.hasChildren?t.lastChild:t.rThr,De=(t,e,n,i)=>{const a=t.firstChild,s=a.lExt,h=t.children[e];s.lThr=n;const l=i-n.relX-a.lExtRelX;s.relX+=l,s.prelim-=l,a.lExt=h.lExt,a.lExtRelX=h.lExtRelX},je=(t,e,n,i)=>{const a=t.children[e],s=a.rExt,h=t.children[e-1];s.rThr=n;const l=i-n.relX-a.rExtRelX;s.relX+=l,s.prelim-=l,a.rExt=h.rExt,a.rExtRelX=h.rExtRelX},Be=t=>{if(t.hasChildren){const e=t.firstChild,n=t.lastChild,i=(e.prelim+e.relX-e.xSize/2+n.relX+n.prelim+n.xSize/2)/2;Object.assign(t,{prelim:i,lExt:e.lExt,lExtRelX:e.lExtRelX,rExt:n.rExt,rExtRelX:n.rExtRelX})}},Oe=(t,e,n)=>{for(;n!==null&&t>=n.lowY;)n=n.next;return{lowY:t,index:e,next:n}},Ie=".markmap{--markmap-max-width: 9999px;--markmap-a-color: #0097e6;--markmap-a-hover-color: #00a8ff;--markmap-code-bg: #f0f0f0;--markmap-code-color: #555;--markmap-highlight-bg: #ffeaa7;--markmap-table-border: 1px solid currentColor;--markmap-font: 300 16px/20px sans-serif;--markmap-circle-open-bg: #fff;--markmap-text-color: #333;--markmap-highlight-node-bg: #ff02;font:var(--markmap-font);color:var(--markmap-text-color)}.markmap-link{fill:none}.markmap-node>circle{cursor:pointer}.markmap-foreign{display:inline-block}.markmap-foreign p{margin:0}.markmap-foreign a{color:var(--markmap-a-color)}.markmap-foreign a:hover{color:var(--markmap-a-hover-color)}.markmap-foreign code{padding:.25em;font-size:calc(1em - 2px);color:var(--markmap-code-color);background-color:var(--markmap-code-bg);border-radius:2px}.markmap-foreign pre{margin:0}.markmap-foreign pre>code{display:block}.markmap-foreign del{text-decoration:line-through}.markmap-foreign em{font-style:italic}.markmap-foreign strong{font-weight:700}.markmap-foreign mark{background:var(--markmap-highlight-bg)}.markmap-foreign table,.markmap-foreign th,.markmap-foreign td{border-collapse:collapse;border:var(--markmap-table-border)}.markmap-foreign img{display:inline-block}.markmap-foreign svg{fill:currentColor}.markmap-foreign>div{width:var(--markmap-max-width);text-align:left}.markmap-foreign>div>div{display:inline-block}.markmap-highlight rect{fill:var(--markmap-highlight-node-bg)}.markmap-dark .markmap{--markmap-code-bg: #1a1b26;--markmap-code-color: #ddd;--markmap-circle-open-bg: #444;--markmap-text-color: #eee}",rt="g.markmap-node",Pe="path.markmap-link",He="g.markmap-highlight",at=Ft();function yt(t,e){const n=$t(t,e);return t[n]}function ot(t){t.stopPropagation()}const Ve=new Qt;class bt{constructor(e,n){this.options={...ae},this._disposeList=[],this.handleZoom=i=>{const{transform:a}=i;this.g.attr("transform",a)},this.handlePan=i=>{i.preventDefault();const a=G(this.svg.node()),s=a.translate(-i.deltaX/a.k,-i.deltaY/a.k);this.svg.call(this.zoom.transform,s)},this.handleClick=(i,a)=>{let s=this.options.toggleRecursively;(vt?i.metaKey:i.ctrlKey)&&(s=!s),this.toggleNode(a,s)},this.ensureView=this.ensureVisible,this.svg=e.datum?e:H(e),this.styleNode=this.svg.append("style"),this.zoom=Zt().filter(i=>this.options.scrollForPan&&i.type==="wheel"?i.ctrlKey&&!i.button:(!i.ctrlKey||i.type==="wheel")&&!i.button).on("zoom",this.handleZoom),this.setOptions(n),this.state={id:this.options.id||this.svg.attr("id")||te(),rect:{x1:0,y1:0,x2:0,y2:0}},this.g=this.svg.append("g"),this.g.append("g").attr("class","markmap-highlight"),this._observer=new ResizeObserver(ne(()=>{this.renderData()},100)),this._disposeList.push(Ve.tap(()=>{this.setData()}),()=>this._observer.disconnect())}getStyleContent(){const{style:e}=this.options,{id:n}=this.state,i=typeof e=="function"?e(n):"";return[this.options.embedGlobalCSS&&Ie,i].filter(Boolean).join(`
`)}updateStyle(){this.svg.attr("class",ee(this.svg.attr("class"),"markmap",this.state.id));const e=this.getStyleContent();this.styleNode.text(e)}async toggleNode(e,n=!1){var i,a;const s=(i=e.payload)!=null&&i.fold?0:1;n?Q(e,(h,l)=>{h.payload={...h.payload,fold:s},l()}):e.payload={...e.payload,fold:(a=e.payload)!=null&&a.fold?0:1},await this.renderData(e)}_initializeData(e){let n=0;const{color:i,initialExpandLevel:a}=this.options;let s=0,h=0;return Q(e,(l,c,d)=>{var f,v,x,E;h+=1,l.children=(f=l.children)==null?void 0:f.map(M=>({...M})),n+=1,l.state={...l.state,depth:h,id:n,rect:{x:0,y:0,width:0,height:0},size:[0,0]},l.state.key=[(v=d==null?void 0:d.state)==null?void 0:v.id,l.state.id].filter(Boolean).join(".")+oe(l.content),l.state.path=[(x=d==null?void 0:d.state)==null?void 0:x.path,l.state.id].filter(Boolean).join("."),i(l);const _=((E=l.payload)==null?void 0:E.fold)===2;_?s+=1:(s||a>=0&&l.state.depth>=a)&&(l.payload={...l.payload,fold:1}),c(),_&&(s-=1),h-=1}),e}_relayout(){if(!this.state.data)return;this.g.selectAll(A(rt)).selectAll(A("foreignObject")).each(function(c){var d;const f=(d=this.firstChild)==null?void 0:d.firstChild,v=[f.scrollWidth,f.scrollHeight];c.state.size=v});const{lineWidth:e,paddingX:n,spacingHorizontal:i,spacingVertical:a}=this.options,s=kt({}).children(c=>{var d;if(!((d=c.payload)!=null&&d.fold))return c.children}).nodeSize(c=>{const[d,f]=c.data.state.size;return[f,d+(d?n*2:0)+i]}).spacing((c,d)=>(c.parent===d.parent?a:a*2)+e(c.data)),h=s.hierarchy(this.state.data);s(h);const l=h.descendants();l.forEach(c=>{const d=c.data;d.state.rect={x:c.y,y:c.x-c.xSize/2,width:c.ySize-i,height:c.xSize}}),this.state.rect={x1:dt(l,c=>c.data.state.rect.x)||0,y1:dt(l,c=>c.data.state.rect.y)||0,x2:ut(l,c=>c.data.state.rect.x+c.data.state.rect.width)||0,y2:ut(l,c=>c.data.state.rect.y+c.data.state.rect.height)||0}}setOptions(e){this.options={...this.options,...e},this.options.zoom?this.svg.call(this.zoom):this.svg.on(".zoom",null),this.options.pan?this.svg.on("wheel",this.handlePan):this.svg.on("wheel",null)}async setData(e,n){n&&this.setOptions(n),e&&(this.state.data=this._initializeData(e)),this.state.data&&(this.updateStyle(),await this.renderData())}async setHighlight(e){this.state.highlight=e||void 0,await this.renderData()}_getHighlightRect(e){const n=this.svg.node(),i=4/G(n).k,a={...e.state.rect};return a.x-=i,a.y-=i,a.width+=2*i,a.height+=2*i,a}async renderData(e){const{paddingX:n,autoFit:i,color:a,maxWidth:s,lineWidth:h}=this.options,l=this.state.data;if(!l)return;const c={},d={},f=[];Q(l,(r,p,b)=>{var X;(X=r.payload)!=null&&X.fold||p(),c[r.state.id]=r,b&&(d[r.state.id]=b.state.id),f.push(r)});const v={},x={},E=r=>{!r||v[r.state.id]||Q(r,(p,b)=>{v[p.state.id]=r.state.id,b()})},_=r=>x[v[r.state.id]]||l.state.rect,M=r=>(c[v[r.state.id]]||l).state.rect;x[l.state.id]=l.state.rect,e&&E(e);let{highlight:C}=this.state;C&&!c[C.state.id]&&(C=void 0);let y=this.g.selectAll(A(He)).selectAll(A("rect")).data(C?[this._getHighlightRect(C)]:[]).join("rect").attr("x",r=>r.x).attr("y",r=>r.y).attr("width",r=>r.width).attr("height",r=>r.height);const T=this.g.selectAll(A(rt)).each(r=>{x[r.state.id]=r.state.rect}).data(f,r=>r.state.key),D=T.enter().append("g").attr("data-depth",r=>r.state.depth).attr("data-path",r=>r.state.path).each(r=>{E(c[d[r.state.id]])}),j=T.exit().each(r=>{E(c[d[r.state.id]])}),$=T.merge(D).attr("class",r=>{var p;return["markmap-node",((p=r.payload)==null?void 0:p.fold)&&"markmap-fold"].filter(Boolean).join(" ")}),R=$.selectAll(A("line")).data(r=>[r],r=>r.state.key),B=R.enter().append("line").attr("stroke",r=>a(r)).attr("stroke-width",0),V=R.merge(B),Y=$.selectAll(A("circle")).data(r=>{var p;return(p=r.children)!=null&&p.length?[r]:[]},r=>r.state.key),W=Y.enter().append("circle").attr("stroke-width",0).attr("r",0).on("click",(r,p)=>this.handleClick(r,p)).on("mousedown",ot).merge(Y).attr("stroke",r=>a(r)).attr("fill",r=>{var p;return(p=r.payload)!=null&&p.fold&&r.children?a(r):"var(--markmap-circle-open-bg)"}),L=this._observer,N=$.selectAll(A("foreignObject")).data(r=>[r],r=>r.state.key),q=N.enter().append("foreignObject").attr("class","markmap-foreign").attr("x",n).attr("y",0).style("opacity",0).on("mousedown",ot).on("dblclick",ot);q.append("xhtml:div").append("xhtml:div").html(r=>r.content).attr("xmlns","http://www.w3.org/1999/xhtml"),q.each(function(){var r;const p=(r=this.firstChild)==null?void 0:r.firstChild;L.observe(p)});const o=j.selectAll(A("foreignObject"));o.each(function(){var r;const p=(r=this.firstChild)==null?void 0:r.firstChild;L.unobserve(p)});const m=q.merge(N),u=f.flatMap(r=>{var p;return(p=r.payload)!=null&&p.fold?[]:r.children.map(b=>({source:r,target:b}))}),g=this.g.selectAll(A(Pe)).data(u,r=>r.target.state.key),k=g.exit(),w=g.enter().insert("path","g").attr("class","markmap-link").attr("data-depth",r=>r.target.state.depth).attr("data-path",r=>r.target.state.path).attr("d",r=>{const p=_(r.target),b=[p.x+p.width,p.y+p.height];return at({source:b,target:b})}).attr("stroke-width",0).merge(g);this.svg.style("--markmap-max-width",s?`${s}px`:null),await new Promise(requestAnimationFrame),this._relayout(),y=y.data(C?[this._getHighlightRect(C)]:[]).join("rect"),this.transition(y).attr("x",r=>r.x).attr("y",r=>r.y).attr("width",r=>r.width).attr("height",r=>r.height),D.attr("transform",r=>{const p=_(r);return`translate(${p.x+p.width-r.state.rect.width},${p.y+p.height-r.state.rect.height})`}),this.transition(j).attr("transform",r=>{const p=M(r),b=p.x+p.width-r.state.rect.width,X=p.y+p.height-r.state.rect.height;return`translate(${b},${X})`}).remove(),this.transition($).attr("transform",r=>`translate(${r.state.rect.x},${r.state.rect.y})`);const z=j.selectAll(A("line"));this.transition(z).attr("x1",r=>r.state.rect.width).attr("stroke-width",0),B.attr("x1",r=>r.state.rect.width).attr("x2",r=>r.state.rect.width),V.attr("y1",r=>r.state.rect.height+h(r)/2).attr("y2",r=>r.state.rect.height+h(r)/2),this.transition(V).attr("x1",-1).attr("x2",r=>r.state.rect.width+2).attr("stroke",r=>a(r)).attr("stroke-width",h);const S=j.selectAll(A("circle"));this.transition(S).attr("r",0).attr("stroke-width",0),W.attr("cx",r=>r.state.rect.width).attr("cy",r=>r.state.rect.height+h(r)/2),this.transition(W).attr("r",6).attr("stroke-width","1.5"),this.transition(o).style("opacity",0),m.attr("width",r=>Math.max(0,r.state.rect.width-n*2)).attr("height",r=>r.state.rect.height),this.transition(m).style("opacity",1),this.transition(k).attr("d",r=>{const p=M(r.target),b=[p.x+p.width,p.y+p.height+h(r.target)/2];return at({source:b,target:b})}).attr("stroke-width",0).remove(),this.transition(w).attr("stroke",r=>a(r.target)).attr("stroke-width",r=>h(r.target)).attr("d",r=>{const p=r.source,b=r.target,X=[p.state.rect.x+p.state.rect.width,p.state.rect.y+p.state.rect.height+h(p)/2],O=[b.state.rect.x,b.state.rect.y+b.state.rect.height+h(b)/2];return at({source:X,target:O})}),i&&this.fit()}transition(e){const{duration:n}=this.options;return e.transition().duration(n)}async fit(e=this.options.maxInitialScale){const n=this.svg.node(),{width:i,height:a}=n.getBoundingClientRect(),{fitRatio:s}=this.options,{x1:h,y1:l,x2:c,y2:d}=this.state.rect,f=c-h,v=d-l,x=Math.min(i/f*s,a/v*s,e),E=ht.translate((i-f*x)/2-h*x,(a-v*x)/2-l*x).scale(x);return this.transition(this.svg).call(this.zoom.transform,E).end().catch(Z)}findElement(e){let n;return this.g.selectAll(A(rt)).each(function(i){i===e&&(n={data:i,g:this})}),n}async ensureVisible(e,n){var i;const a=(i=this.findElement(e))==null?void 0:i.data;if(!a)return;const s=this.svg.node(),h=s.getBoundingClientRect(),l=G(s),[c,d]=[a.state.rect.x,a.state.rect.x+a.state.rect.width+2].map(y=>y*l.k+l.x),[f,v]=[a.state.rect.y,a.state.rect.y+a.state.rect.height].map(y=>y*l.k+l.y),x={left:0,right:0,top:0,bottom:0,...n},E=[x.left-c,h.width-x.right-d],_=[x.top-f,h.height-x.bottom-v],M=E[0]*E[1]>0?yt(E,Math.abs)/l.k:0,C=_[0]*_[1]>0?yt(_,Math.abs)/l.k:0;if(M||C){const y=l.translate(M,C);return this.transition(this.svg).call(this.zoom.transform,y).end().catch(Z)}}async centerNode(e,n){var i;const a=(i=this.findElement(e))==null?void 0:i.data;if(!a)return;const s=this.svg.node(),h=s.getBoundingClientRect(),l=G(s),c=(a.state.rect.x+a.state.rect.width/2)*l.k+l.x,d=(a.state.rect.y+a.state.rect.height/2)*l.k+l.y,f={left:0,right:0,top:0,bottom:0,...n},v=(f.left+h.width-f.right)/2,x=(f.top+h.height-f.bottom)/2,E=(v-c)/l.k,_=(x-d)/l.k;if(E||_){const M=l.translate(E,_);return this.transition(this.svg).call(this.zoom.transform,M).end().catch(Z)}}async rescale(e){const n=this.svg.node(),{width:i,height:a}=n.getBoundingClientRect(),s=i/2,h=a/2,l=G(n),c=l.translate((s-l.x)*(1-e)/l.k,(h-l.y)*(1-e)/l.k).scale(e);return this.transition(this.svg).call(this.zoom.transform,c).end().catch(Z)}destroy(){this.svg.on(".zoom",null),this.svg.html(null),this._disposeList.forEach(e=>{e()})}static create(e,n,i=null){const a=new bt(e,n);return i&&a.setData(i).then(()=>{a.fit()}),a}}export{bt as Markmap,A as childSelector,ie as defaultColorFn,ae as defaultOptions,vt as isMacintosh,re as lineWidthFactory,Ve as refreshHook,oe as simpleHash};
