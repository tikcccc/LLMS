# 地块作业管理系统 Land Lot Management System — 产品 PRD（v1.0）

## 1. 背景与问题

业务希望建设一套**集中式 Web 管理看板** + **现场人员移动端 App** 的地块/作业（WORK LOT）管理系统，用于：

- 统一在地图上管理“作业地块（WORK LOT）”及其状态信息；
- 将任务分配到具体地块并追踪执行进度；
- 现场人员在移动端查看任务、定位到地块并核验 GPS 位置。

系统核心优势与约束：

- **直接集成香港政府 CSDI（Common Spatial Data Infrastructure）地图与地政总署等官方 API 数据源**，使用权威地理空间数据，提升准确性并避免商业地图授权费用。
- 云端部署在香港；对 CSDI 可用性存在依赖。

---

## 2. 产品目标

### 2.1 业务目标

1. 将“地块规划数据 + 官方地块/分区等图层 + 内部规划图层”在一个 Web 端统一呈现并可对比。
2. 以 WORK LOT 为核心对象，实现任务派工、进度追踪、逾期预警与查询报表。
3. 降低现场协调成本：移动端清晰看到任务列表、定位导航与地块信息查询。

### 2.2 用户目标

- 管理者/规划人员：在地图上快速创建/维护 WORK LOT；给地块分配任务；看全局状态与逾期风险；按区域查询与汇总。
- 现场人员：在手机上查看我负责的任务；到现场后核验位置；查看地块信息与任务要求；更新任务状态。

### 2.3 不做什么（非目标）

- 不做对外公众发布的 App（采用直接下载/企业分发方式）。
- 不做复杂三维 BIM/倾斜摄影展示（当前范围是 2D 地图与图层叠加）。
- 不做完整 OA/ERP 工单系统替代（以地块与任务为核心的轻量派工追踪）。

---

## 3. 目标用户与角色权限

### 3.1 用户角色

1. **系统管理员（Admin）**
    - 对系统设置、用户、权限、数据源配置拥有完全控制权。
2. **业务用户（User：管理者/规划者）**
    - 创建/编辑 WORK LOT；为 WORK LOT 分配任务；查看报表。
3. **现场人员（Field Staff）【建议新增角色】**
    - 移动端查看分配给自己的任务；查看地块信息；进行 GPS 核验；更新任务状态。
    - （原文把“Users”定义为创建与派工者，为满足移动端使用场景，建议拆分出现场角色，避免权限过大。）

### 3.2 权限矩阵（MVP）

| 功能 | Admin | 管理者/规划者 | 现场人员 |
| --- | --- | --- | --- |
| 登录/退出 | ✅ | ✅ | ✅ |
| 查看官方底图/政府图层 | ✅ | ✅ | ✅（只读） |
| 查看内部自定义图层 | ✅ | ✅ | ✅（只读，按需） |
| 创建/编辑 WORK LOT | ✅ | ✅ | ❌ |
| 创建/分配任务 | ✅ | ✅ | ❌ |
| 更新任务状态 | ✅ | ✅ | ✅（仅自己任务） |
| 报表查询（列表/地图框选） | ✅ | ✅ | ✅（仅自己相关/只读） |
| 用户管理/系统配置 | ✅ | ❌ | ❌ |

---

## 4. 核心概念与数据对象

### 4.1 WORK LOT（作业地块）

- 地图上用**多边形**圈定的作业范围，可编辑形状。
- 可附带业务属性与状态信息。

**WORK LOT 字段（建议）**

- 基础：`work_lot_id/编码`、`名称`、`几何范围(Polygon)`、`创建人`、`创建时间`
- 业务：`所属项目/区域`【假设】、`备注`
- 状态：`当前任务状态汇总`（由任务计算）或 `地块状态`【假设】

### 4.2 任务（Task）

- 任务必须绑定到某个 WORK LOT。
- 任务状态用于地图颜色预警：红/黄/绿。

**任务字段（MVP 必要）**

- `task_id`、`标题`、`描述`【假设】、`关联work_lot_id`
- `负责人/执行人`（可为用户或团队/单位）【假设】
- `计划开始时间`【假设】、`截止时间`（用于判断 overdue）【假设】
- `状态`：`未开始` / `进行中` / `已完成` / `已逾期`（或系统自动计算逾期）【假设】
- `更新时间`、`更新人`

### 4.3 地图图层

- **政府图层（Government Layer）**：如地块边界、分区（Zoning）等，可开关显示。
- **自定义图层（Custom Layer）**：CEDD 内部规划数据，可开关显示。
- **对比视图（Comparison View）**：政府图层与自定义图层同时展示，便于发现差异。

---

## 5. 典型用户流程

### 5.1 管理者：创建 WORK LOT → 派发任务 → 追踪预警

1. 进入 Web 地图，搜索/定位到目标区域；
2. 打开政府图层与内部图层，对比确认范围；
3. 使用绘制工具画出 WORK LOT 多边形并保存；
4. 在 WORK LOT 上创建任务，指定负责人、截止时间；
5. 系统在地图上以颜色显示任务状态（红逾期/黄进行中/绿完成）；管理者在看板列表/日历查看全局。

### 5.2 现场人员：查看任务列表 → 定位地块 → GPS 核验 → 更新状态

1. 登录移动端，进入任务列表；
2. 点击任务进入详情，查看关联 WORK LOT 信息；
3. 打开地图并显示当前位置（GPS verification）；核对是否在目标地块附近；
4. 完成作业后将任务状态改为完成（必要时备注）。【假设：支持状态更新】

### 5.3 管理者：地图框选查询 → 导出/汇总

1. 在 Web 端使用“地图查询”工具画一个多边形；
2. 系统返回该范围内的 WORK LOT 列表及状态信息。
    
    （【假设】可导出 CSV/PDF 作为增强项）
    

---

## 6. 功能范围与需求拆解（MVP/P1）

> MVP = 必须交付以满足当前文档范围；P1 = 强烈建议增强；P2 = 可选。
> 

### 6.1 Web Portal（管理端）

### 6.1.1 交互式地图（MVP）

- 支持 CSDI 官方底图（街道/地形）。
- 地图基础交互：缩放、平移、地点搜索。
- 【P1】底图切换：示例界面包含 Standard/Topographic/Satellite（若 CSDI 支持）。

**验收要点**

- 首屏加载完成后可正常操作缩放/平移；
- 搜索输入关键字可定位到合理位置；
- 底图与图层不会出现明显错位（同一坐标系/投影）。

### 6.1.2 图层管理与对比（MVP）

- 政府图层开关：如 Lot Boundaries、Zoning。
- 自定义图层开关：CEDD 内部规划数据。
- 对比视图：两类图层可同时显示，便于识别差异。

**【假设】交互细节建议**

- 左侧图层面板：分组（政府/内部）+ 开关；
- 图例（legend）与透明度滑块（P1）。

### 6.1.3 WORK LOT 绘制与编辑（MVP）

- 创建 WORK LOT：在地图上绘制多边形并保存。
- 编辑 WORK LOT：支持拖拽顶点调整、增删点、整体移动。
- WORK LOT 状态/信息录入：给 WORK LOT 添加信息字段。

**【假设】WORK LOT 信息表单（MVP）**

- 必填：名称/编码（二选一）、备注（可选）
- 可选：所属项目、优先级、负责人、附件（P1）

**验收要点**

- 绘制后保存，刷新页面仍存在；
- 编辑后保存成功，几何形状更新；
- 点击 WORK LOT 可弹出详情并展示状态信息。

### 6.1.4 任务模块（Operational Task Module）（MVP）

- 在指定 WORK LOT 上新增任务并分配（Task Assignment）。
- 看板视图：以日历或列表展示所有活跃 WORK LOT 与信息（Dashboard View）。
- 地图预警：用颜色显示任务状态（红=逾期，黄=进行中/中间态，绿=完成）。

**【假设】状态计算规则（建议）**

- 任务 `已完成` → 绿
- 未完成且 `当前时间 > 截止时间` → 红
- 其他未完成 → 黄
    
    （若一个 WORK LOT 多个任务：取“最差状态”做地块颜色，例如红优先）
    

**验收要点**

- 任务创建后在列表/日历可见；
- 任务状态变化会实时反映到地图颜色；
- 逾期规则可复现（用可配置截止时间验证）。

### 6.1.5 报表与查询（Reporting）（MVP）

- 总览报表：列表展示全部 WORK LOT 与相关信息。
- 地图查询：绘制多边形，返回该范围内 WORK LOT 信息。
- 点击查询：点击某个 WORK LOT 获取其信息与状态。

**【P1】增强**

- 导出 CSV/Excel/PDF；
- 筛选：按状态（红/黄/绿）、负责人、日期范围、区域等。

---

### 6.2 Mobile Application（现场端）

### 6.2.1 地图与导航（MVP）

- 显示 CSDI 官方底图（街道/地形）。
- 支持缩放、平移、搜索。

### 6.2.2 任务列表（MVP）

- 任务列表页：简洁显示任务（标题/地块/状态/截止时间）。
- 点击进入任务详情。

### 6.2.3 GPS 核验与地块信息（MVP）

- GPS Verification：显示用户当前位置（手机 GPS）。
- WORK LOT 信息：可点击 WORK LOT 查看信息与状态。

**【假设】可用性建议**

- 任务详情页提供“一键打开地图并高亮地块范围”；
- 显示“我与地块边界最近距离/是否在地块内”（P1，需地理计算）。

### 6.2.4 任务状态更新（P1，强烈建议）

> 原文未明确写“移动端更新任务状态”，但若没有该能力，现场协同闭环不完整。建议纳入 P1（或直接放入 MVP，视交付优先级）。
> 
- 现场人员可将任务标记为：进行中/完成，并写备注。【假设】
- 【P2】上传照片/附件作为证据。

---

### 6.3 用户与权限管理（MVP）

- Admin：系统设置全权（用户、权限、数据源、图层配置）。
- User：创建 WORK LOT、分配任务。
- 【建议】增加 Field Staff 角色（仅移动端执行权限）。

---

## 7. 非功能需求（NFR）

（来自需求原文并补充可执行指标）

1. **可用性/适配**
    - Web 端响应式，适配桌面、笔记本、平板。
2. **安全**
    - 密码加密存储；全链路 HTTPS/SSL。
    - 【建议】登录失败次数限制、审计日志（谁在何时改了地块/任务）。
3. **数据准确性**
    - 地图数据来自香港政府 CSDI，地块边界基于最新官方记录。
4. **性能**
    - 地图在同时展示数百个地块时依旧快速加载与可交互。
    - 【建议指标】首屏可交互 < 3s（内网/常见带宽下），地图操作无明显卡顿（fps/交互延迟可量化）。
5. **可靠性与依赖**
    - 依赖 CSDI 门户/接口可用性。
    - 【建议】缓存策略与降级：CSDI 不可用时提示+继续访问历史数据/内部数据（P1）。

---

## 8. 关键页面与交互（结合示例 UI 的信息结构）

> 示例 UI（PDF 第 3 页）展示了：左侧图层开关、底图切换、地块弹窗详情、任务状态列表、以及一个偏“分析看板”的页面。
> 

### 8.1 Web：地图页（Map View）

- 左侧：图层面板（Government / Custom）、底图切换；
- 地图：显示多个 WORK LOT 多边形（不同颜色/透明度）；
- 点击 WORK LOT：弹窗/侧栏显示 Lot Details（地块信息、任务列表、负责人、状态等）。

### 8.2 Web：任务与运营看板（Dashboard）

- MVP：列表/日历呈现活跃 WORK LOT 与任务状态。
- P2（若参考示例图扩展）：增加“任务状态统计、趋势图、最近活动列表”。

### 8.3 Mobile：任务列表 → 详情 → 地图核验

- 任务列表：一屏清晰展示待办/进行中/已完成；
- 任务详情：地块信息 + 打开地图；
- 地图页：显示当前位置（GPS Verification）+ 地块范围高亮。

---

## 9. 数据与集成方案（产品视角）

### 9.1 外部数据：CSDI / Lands Department

- 用于：底图、政府图层（如 Lot Boundaries、Zoning）。
- 关键点：
    - API/瓦片服务的调用频率限制、密钥策略（若有）【假设】
    - 坐标系/投影一致性处理（HK80/WGS84 等）【假设】

### 9.2 内部数据：CEDD 自定义规划图层

- 展示为可开关的 Custom Layer。
- 【假设】数据接入方式（需在技术方案中确认）：
    - 方案 A：后台导入 GeoJSON/Shapefile；
    - 方案 B：对接内部 GIS 服务/WMS；
    - 方案 C：手工绘制/编辑形成内部图层。

### 9.3 核心数据存储（建议实体）

- `users`
- `work_lots`
- `tasks`
- `layers_config`（图层开关、默认样式等）
- `audit_logs`（P1）

---

## 10. 埋点与成功指标（建议）

### 10.1 业务指标

- 任务按时完成率（完成且未逾期 / 总任务）
- 逾期任务数量趋势（周/月）
- 单个 WORK LOT 的平均处理周期

### 10.2 产品指标

- DAU/WAU（Web 管理端、移动端分别统计）
- 任务更新次数/人/周（现场端闭环是否跑起来）
- 地图性能：首屏加载时间、图层切换耗时、渲染数量峰值

---

## 11. 交付计划与里程碑（沿用需求时间拆分）

- Week 1-2：项目搭建、核心架构、CSDI 集成。
- Week 3-5：地图图层、可视化、任务模块、移动端并行开发。
- Week 6-7：安全、QA、文档与最终交付。
- 总周期：6–8 周。

---

## 12. 项目与商务约束（作为 PRD 附录）

- 预算：HK$200,000；第二年起年费 HK$30,000（维护服务）。
- 付款：40% 预付款，30% 测试完成（User Trial），30% 最终交付与培训。
- 部署：香港云服务器。
- App 分发：不公开上架，提供直接下载链接。
- 支持：上线后 30 天支持；含培训与文档（PDF）。

---

## 13. 风险与对策

1. **CSDI 可用性/限流风险**
    - 对策：缓存底图与常用政府图层；失败降级提示；关键接口重试与熔断（P1）。
2. **政府图层与内部规划图层差异引发误判**
    - 对策：对比模式支持透明度/图例；记录差异点备注；明确数据“来源/更新时间”展示（P1）。
3. **大量地块渲染性能下降**
    - 对策：按视窗加载、矢量切片/聚合、简化几何、分页查询。
4. **移动端分发与更新成本**（非 App Store）
    - 对策：企业签名/MDM 分发策略；版本检查与强制更新策略（P1）。

---

## 14. 待确认点（评审清单，不影响先写 PRD）

1. 政府图层清单：Lot Boundaries、Zoning 之外还需要哪些（道路、规划用途、限制区等）？
2. “Yellow-intermate” 的准确含义：进行中 / 待处理 / 中间态？对应哪些状态流转？
3. WORK LOT 信息字段：必须包含哪些业务字段（项目号、地盘号、责任单位等）？
4. 移动端是否必须支持离线（无网络情况下查看已分配任务与地块）？
5. 任务是否需要附件（照片、文件）与审批流（如完成需复核）？